<div class="chat-container">
    <!-- The p-scroll-panel will contain the conversation history -->
    <p-scroll-panel [style]="{ width: '100%', height: '100%' }" class="chat-panel">
        <!--
          NEW: Using the new @for block for iteration.
          - It's more readable and performant.
          - `track message` is used for efficient DOM updates.
        -->
        <!-- highlight-start -->
        @for (message of messages; track message) {
            <div class="message-row" [ngClass]="{ 'user-message-row': message.author === 'user', 'ai-message-row': message.author === 'ai' }">

                <!-- Avatar for the sender (User or AI) -->
                <p-avatar
                        [icon]="message.author === 'user' ? 'pi pi-user' : 'pi pi-android'"
                        shape="circle"
                        [styleClass]="message.author === 'user' ? 'user-avatar' : 'ai-avatar'">
                </p-avatar>

                <!-- The message bubble -->
                <div class="message-content">
                    <p>{{ message.text }}</p>
                </div>

            </div>
        }
        <!-- highlight-end -->
    </p-scroll-panel>

    <!--
      Input area at the bottom
      UPDATED: Using modern PrimeFlex classes (e.g., 'flex' instead of 'p-d-flex')
    -->
    <!-- highlight-start -->
    <div class="chat-input-container flex align-items-center p-2">
    <textarea
            pTextarea
            rows="1"
            [autoResize]="true"
            placeholder="Type your message..."
            class="flex-grow-1"
            [(ngModel)]="newMessage"
            (keydown.enter)="sendMessage(); $event.preventDefault()">
    </textarea>
        <p-button
                icon="pi pi-send"
                styleClass="p-button-rounded p-button-primary ml-2"
                (click)="sendMessage()"
                [disabled]="!newMessage || newMessage.trim() === ''">
        </p-button>
    </div>
    <!-- highlight-end -->
</div>