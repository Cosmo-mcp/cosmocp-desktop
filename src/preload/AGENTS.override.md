# `src/preload` (preload security boundary) — AGENTS override

This file applies to changes under `src/preload/`.

## Purpose

Preload is the **only** place where we bridge data/capabilities from Electron to the renderer via `contextBridge`.

- Entry: `src/preload/index.ts`
- Exposed API: `window.api`
- Generated API client: `src/preload/api.ts` (see below)

## Security rules (non-negotiable)

- Expose **minimal capability APIs** only. Never expose:
  - `fs`, `path`, `child_process`, or any Node/Electron modules
  - raw `ipcRenderer`
- All inputs from the renderer are untrusted:
  - validate arguments (prefer `zod`) at the first trust boundary (usually in main controllers)
  - keep data serializable (structured clone friendly)
- Don’t create new global objects in `window` other than what’s explicitly required.

## Generated file policy (`api.ts`)

- `src/preload/api.ts` is generated by `scripts/generate-api.ts`.
- Do not hand-edit `api.ts` unless you are also updating the generator to make the change reproducible.
- After updating IPC controllers/decorators, run `npm run generate-api` and commit the regenerated file.

## Renderer typing contract

- The renderer uses the preload `Api` type via `src/renderer/src/globals.d.ts`.
- If you change the exported API shape, ensure the type updates flow through generation and the renderer compiles.

## Logging

- Use `electron-log/renderer` (preload runs in a renderer-like context).
- Never log secrets or raw API keys.

## Testing expectations (preload)

- Add tests that assert:
  - `contextBridge.exposeInMainWorld('api', ...)` exports the expected shape.
  - No forbidden modules are exposed.
  - API surface changes are reflected in the renderer types.

